# FastAPI 简介

![](images/img-2026-01-31-11-07-10.png)
![](images/img-2026-01-31-11-07-29.png)
![](images/img-2026-01-31-11-12-38.png)
![](images/img-2026-01-31-11-20-31.png)
![](images/img-2026-01-31-11-24-49.png)

## 开发环境与启动要点

- 建议在项目根目录创建虚拟环境：`python -m venv .venv`，与宿主机（本机操作系统）的全局 Python 隔离
- 在 VS Code 里选择解释器（Select Interpreter），确保运行/调试/安装依赖都使用 `.venv` 的 Python
- 终端出现 `(.venv)` 表示已激活，可直接 `pip install ...`；未激活时可用 `.venv\Scripts\pip`
- 退出/进入虚拟环境：`deactivate`；重新进入（PowerShell）`\.\.venv\Scripts\Activate.ps1`
- Docker 容器本身隔离依赖，容器内一般不需要再建虚拟环境；但本地开发仍建议用 `.venv`
- `requirements.txt` 用 `pip freeze > requirements.txt` 固化依赖；`.gitignore` 加 `.venv/` 避免提交，安装（根据文件重建环境）：
  'pip install -r requirements.txt'

## 启动 FastAPI

- `uvicorn main:app --reload --port 8001`：使用 Uvicorn 启动应用，`main:app` 指 `main.py` 里的 `app`
- `--reload` 仅用于开发，代码变更会自动重启
- 端口冲突时改端口（如 8001、8002）即可多开
- 报错找不到模块时，确认在项目目录运行，或用模块路径：`uvicorn my_fastApi.main:app --reload --port 8001`

## ASGI 概念

- ASGI（异步服务器网关接口）是服务器与应用之间的协议标准
- Uvicorn 是 ASGI 服务器，负责接收请求并交给 FastAPI 处理

## VS Code 创建 FastAPI 项目（虚拟环境隔离）

- 打开一个新文件夹作为项目根目录（如 `D:\codes\study\python\my_fastApi`）
- 在根目录创建虚拟环境：`python -m venv .venv`
- VS Code 选择解释器：`Ctrl+Shift+P` → `Python: Select Interpreter` → 选 `.venv\Scripts\python.exe`
- 安装依赖（激活后）：`pip install fastapi uvicorn`
- 创建入口文件 `main.py`，并用 `uvicorn main:app --reload --port 8001` 启动
- 依赖只安装在 `.venv` 中，不会污染全局 Python 环境

![](images/2026-01-31-14-18-01.png)

## 重新打开 VS Code 后进入虚拟环境

- 进入虚拟环境只影响当前终端：`\.\.venv\Scripts\Activate.ps1`（PowerShell），提示符出现 `(.venv)` 即生效
- VS Code 的运行/调试/提示依赖所选解释器，可能仍是全局 Python
- 建议第一次用 `Ctrl+Shift+P` → `Python: Select Interpreter` 选择 `.venv\Scripts\python.exe`，之后会自动记住

# 路由

![](images/2026-01-31-14-25-01.png)
![](images/2026-01-31-14-26-10.png)
![](images/2026-01-31-14-33-53.png)

## 路由组织方式

- 路由不必都写在 `main.py`，更推荐拆分到多个模块
- `@app.get(...)` 直接注册到 `app`
- `@router.get(...)` 先注册到 `router`，再用 `app.include_router(router)` 挂载到应用
- 常见做法：各模块用 `APIRouter` 定义路由，`main.py` 统一 include

## 路由示例

`routers/users.py`：

```python
from fastapi import APIRouter

router = APIRouter()

@router.get("/users")
def list_users():
    return []
```

`main.py`：

```python
from fastapi import FastAPI
from routers import users

app = FastAPI()
app.include_router(users.router)
```

# 参数

![](images/2026-01-31-14-36-57.png)
![](images/2026-01-31-14-37-30.png)

## 路径参数

![](images/2026-01-31-14-39-57.png)

## 路径参数-Path类型注解

![](images/img-2026-01-31-16-44-00.png)
![](images/img-2026-01-31-16-56-12.png)

## Path 参数示例

- `Path` 用于对路径参数进行校验和描述（如范围、标题、示例）
- 示例：`/items/{item_id}`，要求 `item_id >= 1`

```python
@app.get("/items/{item_id}")
async def get_item(
    item_id: int = Path(
        ...,
        title="Item ID",
        description="Item identifier, must be >= 1",
        ge=1,
        example=100,
    )
):
    return {"item_id": item_id}
```

## 查询参数

![](images/img-2026-01-31-17-00-55.png)
![](images/img-2026-01-31-17-09-11.png)

## Query 参数示例

- `Query` 用于定义查询参数（URL 里的 `?key=value`），并进行校验与描述
- 示例：`/search?q=fastapi&page=1&size=10`

```python
@app.get("/search")
async def search_items(
    q: str = Query(..., min_length=1, max_length=50, description="Search keyword"),
    page: int = Query(1, ge=1, description="Page number"),
    size: int = Query(10, ge=1, le=100, description="Page size"),
):
    return {"q": q, "page": page, "size": size}
```

## 请求体参数

![](images/img-2026-01-31-17-11-43.png)
![](images/img-2026-01-31-17-12-58.png)

## 请求体参数，Field类型注解

![](images/img-2026-01-31-17-19-58.png)
![](images/img-2026-01-31-17-24-52.png)

# 响应类型

![](images/img-2026-01-31-17-28-20.png)
![](images/img-2026-01-31-17-33-10.png)
![](images/img-2026-01-31-17-34-40.png)
![](images/img-2026-01-31-17-41-51.png)
![](images/img-2026-01-31-17-48-44.png)
![](images/img-2026-01-31-18-13-50.png)
![](images/img-2026-01-31-18-14-50.png)

# 异常处理

![](images/img-2026-01-31-18-17-33.png)

# 中间件

![](images/img-2026-02-02-11-01-26.png)
![](images/img-2026-02-02-11-02-06.png)
![](images/img-2026-02-02-11-04-40.png)
![](images/img-2026-02-02-11-06-22.png)
![](images/img-2026-02-02-11-52-37.png)

## 协程对象与 await

- 调用 `async def` 函数不会立刻执行，而是返回“协程对象”（coroutine object）
- 协程对象是“尚未执行的异步任务”，必须用 `await` 才会真正运行并得到结果
- 不 `await` 就拿不到真实响应，甚至会报错

```python
async def foo():
    return 123

coro = foo()          # 协程对象，尚未执行
result = await foo()  # 执行并返回 123
```

# 依赖注入

![](images/img-2026-02-02-11-56-11.png)
![](images/img-2026-02-02-11-56-40.png)
![](images/img-2026-02-02-11-57-43.png)
![](images/img-2026-02-02-11-58-09.png)
![](images/img-2026-02-02-11-59-34.png)
![](images/img-2026-02-02-12-20-05.png)

# ORM对象关系映射

![](images/img-2026-02-04-17-45-26.png)
![](images/img-2026-02-04-17-47-07.png)
![](images/img-2026-02-04-17-48-21.png)
![](images/img-2026-02-04-18-05-25.png)
![](images/img-2026-02-04-18-07-09.png)
